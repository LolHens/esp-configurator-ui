<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>ESP Configurator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

<!-- ES Module Shims: Import maps polyfill for modules browsers without import maps support (all except Chrome 89+) -->
<script async src="https://ga.jspm.io/npm:es-module-shims@0.10.1/dist/es-module-shims.min.js"></script>

<!--
  JSPM Generator Import Map
  https://generator.jspm.io/
-->
<script type="importmap">
  {
    "imports": {
      "htm": "https://ga.jspm.io/npm:htm@3.0.4/dist/htm.js",
      "lodash.uniqueid": "https://ga.jspm.io/npm:lodash.uniqueid@4.0.1/index.js",
      "react": "https://ga.jspm.io/npm:react@17.0.2/dev.index.js",
      "react-dom": "https://ga.jspm.io/npm:react-dom@17.0.2/dev.index.js"
    },
    "scopes": {
      "https://ga.jspm.io/": {
        "object-assign": "https://ga.jspm.io/npm:object-assign@4.1.1/index.js",
        "scheduler": "https://ga.jspm.io/npm:scheduler@0.20.2/dev.index.js",
        "scheduler/tracing": "https://ga.jspm.io/npm:scheduler@0.20.2/dev.tracing.js"
      }
    }
  }
</script>

<style>

</style>

<div id="root"></div>

<script type="module">
    import React from 'react'
    import ReactDOM from 'react-dom'
    import htm from 'htm'
    import uniqueId from 'lodash.uniqueid'

    const html = htm.bind(React.createElement)

    function SignalStrengthIcon(props) {
        const {strength} = props;
        return html`<i
                className="bi bi-${strength >= 8 ? "wifi" : strength > 2 ? "wifi-2" : "wifi-1"} ${props.className || ""}"></i>`;
    }

    function EncryptedIcon(props) {
        return props.encrypted && html`<i className="bi bi-lock ${props.className || ""}"></i>`;
    }

    function BatteryIcon(props) {
        const {charge, charging} = props;
        return html`<i
                className="bi bi-${charging ? "battery-charging" : charge >= 8 ? "battery-full" : charge > 2 ? "battery-half" : "battery"} ${props.className || ""}"></i>`
    }

    function NetworkListEntry(props) {
        const {network: {ssid, strength, encrypted}, activeSsid} = props;
        return html`
            <button type="button"
                    className="list-group-item list-group-item-action ${activeSsid === ssid ? "active" : ""} ${props.className || ""}">
                <${SignalStrengthIcon} strength=${strength} className="pe-3"/>
                ${ssid}
                <${EncryptedIcon} encrypted=${encrypted} className="float-end"/>
            </button>
        `
    }

    class WifiManager extends React.Component {
        constructor(props) {
            super(props);
        }


        render() {
            const {networks, activeSsid} = this.props
            return html`
                <div className="list-group fs-2">
                    ${networks.map((network, i) => html`
                        <${NetworkListEntry} network=${network} activeSsid=${activeSsid} key="${i}"/>
                    `)}
                </div>
            `
        }
    }

    class App extends React.Component {
        constructor(props) {
            super(props)
            this.state = {
                id: uniqueId(),
                schedules: {}
            }
        }

        componentDidMount() {
            let self = this
            setInterval(() => console.log("update " + self), 2000)
        }

        render() {
            const {} = this.state
            return html`
                <div className="flex mb-4">
                    <${BatteryIcon} charge=${10} className="fs-2"/>
                    <${WifiManager} networks=${
                            [
                                {
                                    ssid: "Network 1",
                                    strength: 10,
                                    encrypted: true
                                },
                                {
                                    ssid: "Test Network",
                                    strength: 5,
                                    encrypted: true
                                },
                                {
                                    ssid: "Low Strength",
                                    strength: 1,
                                    encrypted: false
                                }
                            ]
                    } activeSsid="Test Network"/>
                </div>
            `
        }
    }

    ReactDOM.render(
        html`
            <div className="container my-5 d-flex flex-column">
                <${App}/>
            </div>
        `,
        document.getElementById('root')
    )
</script>
</body>
</html>